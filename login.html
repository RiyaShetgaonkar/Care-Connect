<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
  <style>
    /* ... (Keep your existing CSS exactly as it is) ... */
    body { background-color: #FFFDD0; font-family: 'Segoe UI', sans-serif; color: #006400; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
    .container { background-color: #F0FFF0; padding: 40px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 100, 0, 0.1); width: 100%; max-width: 400px; text-align: center; }
    h2 { color: #228B22; margin-bottom: 20px; font-size: 24px; }
    input[type="email"], input[type="password"] { border: 2px solid #32CD32; padding: 12px; margin: 10px 0; width: 100%; box-sizing: border-box; border-radius: 5px; font-size: 16px; }
    button { background-color: #228B22; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; margin-top: 10px; transition: 0.3s; }
    button:hover { background-color: #006400; }
    p { color: #008000; margin-top: 20px; font-size: 14px; }
    a { color: #00FF00; text-decoration: none; }
  </style>
</head>
<body>

<div class="container">
  <h2>Login</h2>
  <form id="loginForm">
    <input type="email" id="email" placeholder="Email" required><br><br>
    <input type="password" id="password" placeholder="Password" required><br><br>
    <button type="submit">Login</button>
  </form>
  <p>Don't have an account? <a href="signup.html">Signup</a></p>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDW6yd_F-Bb5YmXH5gmIRBctDa8gG9leA0",
    authDomain: "care-connect-d46f0.firebaseapp.com",
    projectId: "care-connect-d46f0",
    storageBucket: "care-connect-d46f0.firebasestorage.app",
    messagingSenderId: "55079005278",
    appId: "1:55079005278:web:ad57ecb0ebf23f292798cf"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    try {
      // Authenticate with Firebase
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      // Get token to notify our backend
      const token = await user.getIdToken();
      
      // Initialize user in our Firestore via Node backend
      await fetch("/api/auth/init-user", {
        method: "POST",
        headers: { "Authorization": `Bearer ${token}` }
      });

      alert("Login successful!");
      window.location.href = "dashboard.html";
    } catch (error) {
      console.error(error);
      alert("Login failed: " + error.message);
    }
  });
</script>

</body>
</html>
